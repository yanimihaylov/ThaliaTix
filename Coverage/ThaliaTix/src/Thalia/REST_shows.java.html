<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>REST_shows.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">testCases (Nov 23, 2017 9:16:09 PM)</a> &gt; <a href="../../index.html" class="el_group">ThaliaTix</a> &gt; <a href="../index.html" class="el_bundle">src</a> &gt; <a href="index.source.html" class="el_package">Thalia</a> &gt; <span class="el_source">REST_shows.java</span></div><h1>REST_shows.java</h1><pre class="source lang-java linenums">package Thalia;

import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import com.google.gson.JsonArray;
import com.google.gson.JsonElement;
import com.google.gson.JsonObject;

import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;

import javax.annotation.PostConstruct;
import javax.ws.rs.*;
import javax.ws.rs.core.*;

@Path(&quot;/&quot;)
<span class="nc" id="L20">public class REST_shows {</span>
	
<span class="nc" id="L22">	private InterfaceShows is = new ShowManager();</span>
<span class="nc" id="L23">	private InterfaceSeating iseat = new SeatingManager();</span>
<span class="nc" id="L24">	private interfaceOrders iord = new orderManager();</span>
<span class="nc" id="L25">	private InterfaceTicket itic = new ticketManager();</span>
<span class="nc" id="L26">	private interfaceSub isub = new subManager();</span>
<span class="nc" id="L27">	private requestShows rs = new requestShows();</span>
<span class="nc" id="L28">	private initTheater it = new initTheater();</span>
	Section initSection;
	Seating initSeating;
	Seat initSeat;

	
	@PostConstruct
    public void postConstruct() {
        //Initialize theater seating
    		
<span class="nc" id="L38">	}</span>
	
	@GET
	@Path(&quot;/thalia&quot;)
	public Response initTheater() {
<span class="nc" id="L43">		it.create();</span>
<span class="nc" id="L44">        return Response.status(Response.Status.OK).entity(&quot;Theater Built!&quot;).build();</span>
	}
    
    
    //CREATE SHOWS
	@Path(&quot;/show&quot;)
    @POST
    @Produces(MediaType.APPLICATION_JSON)
    public Response createShows(String json) {
		
<span class="nc" id="L54">        Gson gson = new Gson();</span>
        
<span class="nc" id="L56">        JsonObject obj = gson.fromJson(json, JsonObject.class);</span>
<span class="nc" id="L57">		JsonElement showJSON = obj.get(&quot;show_info&quot;);</span>
		
<span class="nc" id="L59">		JsonArray seatJSON = obj.getAsJsonArray(&quot;seating_info&quot;);</span>
		
		
<span class="nc" id="L62">		String showString = showJSON.toString();</span>
		
<span class="nc" id="L64">        shows s = gson.fromJson(showString, shows.class); </span>
<span class="nc" id="L65">        shows ns = is.createShow(s.getName(), s.getWeb(), s.getDate(), s.getTime());</span>
        
<span class="nc bnc" id="L67" title="All 2 branches missed.">        for(int i = 0; i &lt; seatJSON.size(); i++)</span>
        {
<span class="nc" id="L69">        		JsonObject seatJSONobj = seatJSON.get(i).getAsJsonObject();</span>
<span class="nc" id="L70">        		Section sec = gson.fromJson(seatJSONobj, Section.class);</span>
<span class="nc" id="L71">        		Section nsec = iseat.createSections(sec.getSection_name(), Integer.parseInt(sec.getSid()), sec.getPrice());</span>
        		
<span class="nc bnc" id="L73" title="All 2 branches missed.">        		if(sec.getSid().equals(&quot;123&quot;)) {</span>
<span class="nc" id="L74">        			nsec = it.initFrontRight();</span>
<span class="nc" id="L75">        			nsec.setPrice(sec.getPrice());}</span>
<span class="nc bnc" id="L76" title="All 2 branches missed.">        		if(sec.getSid().equals(&quot;124&quot;)) {</span>
<span class="nc" id="L77">        			nsec = it.initFrontCenter();</span>
<span class="nc" id="L78">        			nsec.setPrice(sec.getPrice());}</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">        		if(sec.getSid().equals(&quot;125&quot;)) {</span>
<span class="nc" id="L80">        			nsec = it.initFrontLeft();        </span>
<span class="nc" id="L81">        			nsec.setPrice(sec.getPrice());}</span>
<span class="nc bnc" id="L82" title="All 2 branches missed.">        		if(sec.getSid().equals(&quot;126&quot;)) {</span>
<span class="nc" id="L83">        			nsec = it.initMainRight();</span>
<span class="nc" id="L84">        			nsec.setPrice(sec.getPrice());}</span>
<span class="nc bnc" id="L85" title="All 2 branches missed.">        		if(sec.getSid().equals(&quot;127&quot;)) {</span>
<span class="nc" id="L86">        			nsec = it.initMainCenter();        		</span>
<span class="nc" id="L87">        			nsec.setPrice(sec.getPrice());}</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">        		if(sec.getSid().equals(&quot;128&quot;)) {</span>
<span class="nc" id="L89">        			nsec = it.initMainLeft();}</span>
        		
<span class="nc" id="L91">        		ns.add(i, nsec);</span>
        		

        }  
     
<span class="nc" id="L96">	Gson gsonb = new GsonBuilder().setPrettyPrinting().create();</span>
<span class="nc" id="L97">	String st = gsonb.toJson(&quot;Done! :)&quot;);</span>
	     
<span class="nc" id="L99">	return Response.ok(st).build();</span>
    }
    
    //UPDATE SHOWS
    @Path(&quot;/show/{id}&quot;)
    @PUT
    @Produces(MediaType.APPLICATION_JSON)
    public Response makeLamp(@PathParam(&quot;id&quot;) int showID, String json) {
    	
<span class="nc" id="L108">    		int id = showID;</span>
<span class="nc" id="L109">    		Gson gson = new Gson();</span>
<span class="nc" id="L110">        shows sIn = is.getShowDetail(id);</span>
<span class="nc" id="L111">        shows s = gson.fromJson(json, shows.class);</span>
        
        
<span class="nc" id="L114">        JsonObject obj = gson.fromJson(json, JsonObject.class);</span>
<span class="nc" id="L115">		JsonElement showJSON = obj.get(&quot;show_info&quot;);</span>
		
<span class="nc" id="L117">		JsonArray seatJSON = obj.getAsJsonArray(&quot;seating_info&quot;);</span>
		
		
<span class="nc" id="L120">		String showString = showJSON.toString();</span>
		
<span class="nc" id="L122">        showInfo sInfo = gson.fromJson(showString, showInfo.class);</span>
<span class="nc" id="L123">        s.setShowInfo(sInfo);</span>
        
<span class="nc bnc" id="L125" title="All 2 branches missed.">        for(int i = 0; i &lt; seatJSON.size(); i++)</span>
        {
<span class="nc" id="L127">        		JsonObject seatJSONobj = seatJSON.get(i).getAsJsonObject();</span>
<span class="nc" id="L128">        		Section sec = gson.fromJson(seatJSONobj, Section.class);</span>
<span class="nc" id="L129">        		Section nsec = iseat.createSections(sec.getSection_name(), Integer.parseInt(sec.getSid()), sec.getPrice());</span>
        		
<span class="nc bnc" id="L131" title="All 2 branches missed.">        		if(sec.getSid().equals(&quot;123&quot;)) {</span>
<span class="nc" id="L132">        			nsec = it.initFrontRight();</span>
<span class="nc" id="L133">        			nsec.setPrice(sec.getPrice());}</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">        		if(sec.getSid().equals(&quot;124&quot;)) {</span>
<span class="nc" id="L135">        			nsec = it.initFrontCenter();</span>
<span class="nc" id="L136">        			nsec.setPrice(sec.getPrice());}</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">        		if(sec.getSid().equals(&quot;125&quot;)) {</span>
<span class="nc" id="L138">        			nsec = it.initFrontLeft();        </span>
<span class="nc" id="L139">        			nsec.setPrice(sec.getPrice());}</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">        		if(sec.getSid().equals(&quot;126&quot;)) {</span>
<span class="nc" id="L141">        			nsec = it.initMainRight();</span>
<span class="nc" id="L142">        			nsec.setPrice(sec.getPrice());}</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">        		if(sec.getSid().equals(&quot;127&quot;)) {</span>
<span class="nc" id="L144">        			nsec = it.initMainCenter();        		</span>
<span class="nc" id="L145">        			nsec.setPrice(sec.getPrice());}</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">        		if(sec.getSid().equals(&quot;128&quot;)) {</span>
<span class="nc" id="L147">        			nsec = it.initMainLeft();}</span>
        		
<span class="nc" id="L149">        		s.set(i, nsec);</span>
        		

        }  
        
<span class="nc" id="L154">        s.setWid(Integer.toString(id));</span>
        
<span class="nc bnc" id="L156" title="All 2 branches missed.">        if (sIn.isNil()) {</span>
            // return a 404
<span class="nc" id="L158">            return Response.status(Response.Status.NOT_FOUND).entity(&quot;:( Entity not found for ID: &quot; + id).build();</span>
        }
        else {
<span class="nc" id="L161">        		is.updateShow(id, s);</span>
<span class="nc" id="L162">        		return Response.status(Response.Status.ACCEPTED).entity(&quot;Show updated.&quot;).build();        </span>
        		}
    }
    
    
  //VIEW SHOW
    @Path(&quot;/show/{id}&quot;)
    @GET
    @Produces(MediaType.APPLICATION_JSON)
    public Response getSpecificShow(@PathParam(&quot;id&quot;) int wid) {
        // call the &quot;Get Show Detail&quot; use case
<span class="nc" id="L173">        shows s = is.getShowDetail(wid);</span>
<span class="nc bnc" id="L174" title="All 2 branches missed.">        if (s.isNil()) {</span>
            // return a 404
<span class="nc" id="L176">            return Response.status(Response.Status.NOT_FOUND).entity(&quot;:( Entity not found for ID: &quot; + wid).build();</span>
        } else {
        	
        	
        	
<span class="nc" id="L181">            Gson gson = new GsonBuilder().setPrettyPrinting().create();</span>
<span class="nc" id="L182">            String st = gson.toJson(s);</span>
            
<span class="nc" id="L184">            JsonObject obj = gson.fromJson(st, JsonObject.class);</span>
            //obj.getAsJsonObject().remove(&quot;price&quot;);
<span class="nc" id="L186">            JsonArray objArr = obj.getAsJsonArray(&quot;seating_info&quot;); </span>
<span class="nc bnc" id="L187" title="All 2 branches missed.">            for(int i=0; i&lt;objArr.size(); i++) {</span>
            		
<span class="nc" id="L189">            		objArr.get(i).getAsJsonObject().remove(&quot;seating&quot;);</span>
<span class="nc" id="L190">            		objArr.get(i).getAsJsonObject().remove(&quot;section_name&quot;);</span>
            		
            }
            
<span class="nc" id="L194">            st = gson.toJson(obj);</span>
            
<span class="nc" id="L196">            return Response.ok(st).build();</span>
        }
    }
    
    //VIEW ALL SHOWS
    @Path(&quot;/show&quot;)
    @GET
    @Produces(MediaType.APPLICATION_JSON)
    public Response getAllShows() {
        // calls the &quot;Get All Shows&quot; use case
<span class="nc" id="L206">        Gson gson = new GsonBuilder().setPrettyPrinting().create();</span>
<span class="nc" id="L207">        List&lt;shows&gt; showsList = is.getAllShows();</span>

<span class="nc" id="L209">        String s = gson.toJson(showsList);</span>
<span class="nc" id="L210">        JsonArray objArr = gson.fromJson(s, JsonArray.class);</span>
        
<span class="nc bnc" id="L212" title="All 2 branches missed.">        for(int i=0; i&lt;objArr.size(); i++) {</span>
<span class="nc" id="L213">	        objArr.get(i).getAsJsonObject().remove(&quot;seating_info&quot;);</span>
        }
<span class="nc" id="L215">        s = gson.toJson(objArr);</span>
        
<span class="nc" id="L217">        return Response.status(Response.Status.OK).entity(s).build();</span>
    }
    
    
    
    //VIEW SHOW SECTIONS
    @Path(&quot;/show/{id}/sections&quot;)
    @GET
    @Produces(MediaType.APPLICATION_JSON)
    public Response getShowSections(@PathParam(&quot;id&quot;) int wid) {
        // call the &quot;Get Show Detail&quot; use case
<span class="nc" id="L228">        shows s = is.getShowDetail(wid);</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">        if (s.isNil()) {</span>
            // return a 404
<span class="nc" id="L231">            return Response.status(Response.Status.NOT_FOUND).entity(&quot;:( Entity not found for ID: &quot; + wid).build();</span>
        } else {
        	
        	
<span class="nc" id="L235">            Gson gson = new GsonBuilder().setPrettyPrinting().create();</span>
<span class="nc" id="L236">            String st = gson.toJson(s.getSections());</span>
            
<span class="nc" id="L238">            JsonArray objArr = gson.fromJson(st, JsonArray.class);</span>
<span class="nc bnc" id="L239" title="All 2 branches missed.">            for(int i=0; i&lt;objArr.size(); i++) {</span>
<span class="nc" id="L240">            		objArr.get(i).getAsJsonObject().remove(&quot;seating&quot;);</span>
            }
<span class="nc" id="L242">            st = gson.toJson(objArr);</span>
<span class="nc" id="L243">            return Response.ok(st).build();</span>
        }
    }
    
    
  //VIEW SHOW SPECIFIC SECTION
    @Path(&quot;/show/{id}/sections/{sid}&quot;)
    @GET
    @Produces(MediaType.APPLICATION_JSON)
    public Response getShowSpecificSection(@PathParam(&quot;id&quot;) int wid, @PathParam(&quot;sid&quot;) int sid) {
        // call the &quot;Get Show Detail&quot; use case
<span class="nc" id="L254">    		shows sh = is.getShowDetail(wid);</span>
<span class="nc" id="L255">        Section s = is.getSpecificSection(wid, sid);</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">        if (s.isNil()) {</span>
            // return a 404
<span class="nc" id="L258">            return Response.status(Response.Status.NOT_FOUND).entity(&quot;:( Entity not found for ID: &quot; + wid).build();</span>
        } else {
<span class="nc" id="L260">            Gson gson = new GsonBuilder().setPrettyPrinting().create();</span>
            
<span class="nc" id="L262">            String shSt = gson.toJson(sh);</span>
            
<span class="nc" id="L264">            JsonObject obj = gson.fromJson(shSt, JsonObject.class);</span>
<span class="nc" id="L265">            obj.getAsJsonObject().remove(&quot;seating_info&quot;);</span>

            
<span class="nc" id="L268">            shSt = gson.toJson(obj);</span>
<span class="nc" id="L269">            String secSt = gson.toJson(s);</span>
            
            
<span class="nc" id="L272">            shSt = shSt.substring(0, shSt.length()-2);</span>
<span class="nc" id="L273">            secSt = secSt.substring(1);</span>
            
<span class="nc" id="L275">            String totalString =  shSt + &quot;, &quot; + secSt;</span>
<span class="nc" id="L276">            return Response.ok(totalString).build();</span>
        }
    }
    
    
    //SUBSCRIBE TO DONATIONS
    @Path(&quot;/show/{wid}/donations&quot;)
    @POST
    @Produces(MediaType.APPLICATION_JSON)
    public Response subscribe(@PathParam(&quot;wid&quot;) int wid,String json) {
 		
<span class="nc" id="L287">        Gson gson = new Gson();</span>
        
<span class="nc" id="L289">        JsonObject obj = gson.fromJson(json, JsonObject.class);</span>
<span class="nc" id="L290"> 		JsonElement patronJSON = obj.get(&quot;patron_info&quot;);</span>
<span class="nc" id="L291"> 		JsonElement countJSON = obj.get(&quot;count&quot;);</span>

 		
<span class="nc" id="L294"> 		String patronString = patronJSON.toString();</span>
<span class="nc" id="L295">        patron pat = gson.fromJson(patronString, patron.class);</span>
        
 	
<span class="nc" id="L298"> 		int countInt = Integer.parseInt(countJSON.toString());</span>
 		
<span class="nc" id="L300"> 		subscribeDonations subD = isub.createSub(wid, countInt);</span>
<span class="nc" id="L301"> 		subD.setPatron_info(pat);</span>
 		
 		
		
<span class="nc" id="L305">		Gson gsonb = new GsonBuilder().setPrettyPrinting().create();</span>
<span class="nc" id="L306">	 	String ret = gsonb.toJson(subD);</span>
	 	
<span class="nc" id="L308">	 	JsonObject result = gson.fromJson(ret, JsonObject.class);</span>
<span class="nc" id="L309">	 	result.remove(&quot;patron_info&quot;);</span>
<span class="nc" id="L310">	 	result.remove(&quot;wid&quot;);</span>
<span class="nc" id="L311">	 	result.remove(&quot;count&quot;);</span>
<span class="nc" id="L312">	 	result.remove(&quot;tickets&quot;);</span>
<span class="nc" id="L313">	 	String resultString = gson.toJson(result);</span>
	 	     
<span class="nc" id="L315">	 	return Response.ok(resultString).build();</span>
    }
    
    
    //STATUS OF REQUEST FOR DONATED TICKETS
    @Path(&quot;/show/{id}/donations/{did}&quot;)
    @GET
    @Produces(MediaType.APPLICATION_JSON)
    public Response getSpecificSub(@PathParam(&quot;id&quot;) int wid, @PathParam(&quot;did&quot;) int did) {
        // call the &quot;Get Show Detail&quot; use case	
<span class="nc" id="L325">    		subscribeDonations s = isub.getSpecificSub(wid, did);</span>
<span class="nc" id="L326">    		s = isub.checkStatus(s);</span>
<span class="nc bnc" id="L327" title="All 2 branches missed.">        if (s.isNil()) {</span>
            // return a 404
<span class="nc" id="L329">            return Response.status(Response.Status.NOT_FOUND).entity(&quot;:( Entity not found for ID: &quot; + did).build();</span>
        } else {
        	
<span class="nc" id="L332">            Gson gson = new GsonBuilder().setPrettyPrinting().create();</span>
<span class="nc" id="L333">            String res = gson.toJson(s);        </span>
            
<span class="nc" id="L335">            JsonObject obj = gson.fromJson(res, JsonObject.class);</span>
            /*JsonArray arr = obj.getAsJsonArray(&quot;tickets&quot;);
            for(int i= 0; i&lt;arr.size(); i++) {
            		JsonObject tObject = arr.get(i).getAsJsonObject();
            }*/
            
<span class="nc" id="L341">            res = gson.toJson(obj);        </span>

<span class="nc" id="L343">            return Response.ok(res).build();</span>
        }
    }
    
    
    
    
    ///////////////////////////////SEATING///////////////////////////////
   
    //VIEW ALL SEATING
    @Path(&quot;/seating&quot;)
    @GET
    @Produces(MediaType.APPLICATION_JSON)
    public Response getAllSeats() {
        // calls the &quot;Get All Seats&quot; use case
<span class="nc" id="L358">        Gson gson = new GsonBuilder().setPrettyPrinting().create();</span>
<span class="nc" id="L359">        String s = gson.toJson(iseat.getAllSeats());</span>
<span class="nc" id="L360">        JsonArray objArr = gson.fromJson(s, JsonArray.class);</span>
        
<span class="nc bnc" id="L362" title="All 2 branches missed.">        for(int i=0; i&lt;objArr.size(); i++) {</span>
<span class="nc" id="L363">	        objArr.get(i).getAsJsonObject().remove(&quot;price&quot;);</span>
<span class="nc" id="L364">	        objArr.get(i).getAsJsonObject().remove(&quot;seating&quot;);</span>
        }
<span class="nc" id="L366">        s = gson.toJson(objArr);</span>
<span class="nc" id="L367">        return Response.status(Response.Status.OK).entity(s).build();</span>
    }
    
    
    //VIEW SPECIFIC SECTION
    @Path(&quot;/seating/{id}&quot;)
    @GET
    @Produces(MediaType.APPLICATION_JSON)
    public Response getSpecificSection(@PathParam(&quot;id&quot;) int wid) {
        // call the &quot;Get Show Detail&quot; use case
<span class="nc" id="L377">        Section s = iseat.getSectionDetail(wid);</span>
        
<span class="nc bnc" id="L379" title="All 2 branches missed.">        if (s.isNil()) {</span>
            // return a 404
<span class="nc" id="L381">            return Response.status(Response.Status.NOT_FOUND).entity(&quot;:( Entity not found for ID: &quot; + wid).build();</span>
        } else {
<span class="nc" id="L383">            Gson gson = new GsonBuilder().setPrettyPrinting().create();</span>
            
<span class="nc" id="L385">            String st = gson.toJson(s);</span>
            
<span class="nc" id="L387">            JsonObject obj = gson.fromJson(st, JsonObject.class);</span>
<span class="nc" id="L388">            obj.getAsJsonObject().remove(&quot;price&quot;);</span>
            
<span class="nc bnc" id="L390" title="All 2 branches missed.">            for(int i=0; i&lt;obj.getAsJsonArray(&quot;seating&quot;).size(); i++) {</span>
            	
<span class="nc" id="L392">            		JsonArray ja = obj.getAsJsonArray(&quot;seating&quot;).get(i).getAsJsonObject().getAsJsonArray(&quot;seats&quot;);</span>
            		
<span class="nc bnc" id="L394" title="All 2 branches missed.">            		for(int j=0; j&lt;ja.size(); j++) {</span>
<span class="nc" id="L395">            			ja.get(j).getAsJsonObject().remove(&quot;cid&quot;);</span>
<span class="nc" id="L396">            			ja.get(j).getAsJsonObject().remove(&quot;status&quot;);</span>
            		}
            		
            }
<span class="nc" id="L400">            st = gson.toJson(obj);</span>
<span class="nc" id="L401">            return Response.ok(st).build();</span>
        }
    }
    
    //REQUEST SEATS AUTO
   /* @Path(&quot;/seating&quot;)
    @GET
    @Produces(MediaType.APPLICATION_JSON)
    public Response getAutoSeats(@QueryParam(&quot;show&quot;) int wid, @QueryParam(&quot;section&quot;) int sid, @QueryParam(&quot;count&quot;) int count, @QueryParam(&quot;starting_seat_id&quot;) int cid) {
        // call the &quot;Get Show Detail&quot; use case
        requestResponse response = rs.autoShows(wid, sid, count, cid);
        if (response.isNil()) {
            // return a 404
            return Response.status(Response.Status.NOT_FOUND).entity(&quot;:( Entity not found for ID: &quot; + wid).build();
        } else {
            Gson gson = new GsonBuilder().setPrettyPrinting().create();
            String st = gson.toJson(response);
            
            JsonObject obj = gson.fromJson(st, JsonObject.class);
            
            obj.getAsJsonObject(&quot;info&quot;).remove(&quot;seating_info&quot;);
            
            st = gson.toJson(obj);
            return Response.ok(st).build();
        }
    }
    */
    
    
    
    ///////////////////////////////ORDERS///////////////////////////////

    //CREATE ORDERS
 	@Path(&quot;/orders&quot;)
     @POST
     @Produces(MediaType.APPLICATION_JSON)
     public Response createOrders(String json) {
 		
<span class="nc" id="L439">         Gson gson = new Gson();</span>
         
<span class="nc" id="L441">        int price=0;</span>
<span class="nc" id="L442">        int ticketCount=0;</span>
         
<span class="nc" id="L444">        JsonObject obj = gson.fromJson(json, JsonObject.class);</span>
<span class="nc" id="L445"> 		JsonElement patronJSON = obj.get(&quot;patron_info&quot;);</span>
<span class="nc" id="L446"> 		JsonElement widJSON = obj.get(&quot;wid&quot;);</span>
<span class="nc" id="L447"> 		JsonElement sidJSON = obj.get(&quot;sid&quot;);</span>
 		
<span class="nc" id="L449"> 		JsonArray seatJSON = obj.getAsJsonArray(&quot;seats&quot;);</span>
 		
 		//JsonObject seatObj = seatJSON.getAsJsonObject();
 		
<span class="nc" id="L453"> 		String patronString = patronJSON.toString();</span>
 		
<span class="nc" id="L455"> 		int widInt = Integer.parseInt(widJSON.toString().substring(1,widJSON.toString().length()-1));		</span>
<span class="nc" id="L456"> 		int sidInt = Integer.parseInt(sidJSON.toString().substring(1,sidJSON.toString().length()-1));</span>
 		
<span class="nc" id="L458">         patron pat = gson.fromJson(patronString, patron.class); </span>
<span class="nc" id="L459">         orders ord = iord.createOrder(widInt, sidInt, pat.getName(), pat.getPhone(), pat.getEmail(), pat.getBilling_address(), pat.getCc_number(), pat.getCc_exp_date());</span>
<span class="nc" id="L460">  		 shows s = is.getShowDetail(widInt);         </span>
  		
<span class="nc" id="L462">  		 ord.setShowI(s.getShowInfo());</span>
<span class="nc" id="L463">  		 ord.setWid(widInt);</span>
<span class="nc" id="L464">  		 ord.setSid(sidInt);</span>
  		 
<span class="nc" id="L466">  		List&lt;ticket&gt; ticArray = new ArrayList&lt;ticket&gt;();</span>
<span class="nc bnc" id="L467" title="All 2 branches missed.">         for(int i = 0; i &lt; seatJSON.size(); i++)</span>
         {
<span class="nc" id="L469">        	 	JsonObject seatJSONobj = seatJSON.get(i).getAsJsonObject();</span>
<span class="nc" id="L470">     		Seat st = gson.fromJson(seatJSONobj, Seat.class);</span>
<span class="nc" id="L471">     		int cid = Integer.parseInt(st.getCid());</span>

     		
<span class="nc" id="L474">            Section sec = is.getSpecificSection(widInt, sidInt);</span>
<span class="nc" id="L475">            price = sec.getPrice();</span>
<span class="nc" id="L476">            String name = sec.getSection_name();</span>

<span class="nc" id="L478">     		List&lt;Seating&gt; secArray = sec.getSeating();</span>
     		
     		
<span class="nc bnc" id="L481" title="All 2 branches missed.">     		for(int k=0; k&lt;secArray.size(); k++) {</span>
<span class="nc" id="L482">     			List&lt;Seat&gt; seats = secArray.get(k).getSeats();</span>
     			
<span class="nc bnc" id="L484" title="All 2 branches missed.">     			for(int j=0; j&lt;seats.size(); j++) {</span>
<span class="nc bnc" id="L485" title="All 2 branches missed.">     				if(seats.get(j).getCid().equals(Integer.toString(cid))) {</span>
<span class="nc" id="L486">     					seats.get(j).setStatus(&quot;&quot;);</span>
     					
     					//create ticket
<span class="nc" id="L489">     					ticket t = itic.createTicket(price, widInt, sidInt, name);</span>
<span class="nc" id="L490">     					t.setPatronInfo(ord.getPat());</span>
<span class="nc" id="L491">     					t.setShowInfo(ord.getShowI());</span>
<span class="nc" id="L492">     					t.setCid(cid);</span>
<span class="nc" id="L493">     					t.setRow(k+1);</span>
<span class="nc" id="L494">     					ticketCount++;</span>
<span class="nc" id="L495">     					ticArray.add(t);</span>
     					
     				}
     			}
     		}
         }
         
<span class="nc" id="L502">         ord.setTickets(ticArray);</span>
<span class="nc" id="L503">         price*=ticketCount;</span>
<span class="nc" id="L504">         ord.setNumberOfTickets(ticketCount);</span>
<span class="nc" id="L505">         ord.setOrderAmount(price);</span>
<span class="nc" id="L506"> 	Gson gsonb = new GsonBuilder().setPrettyPrinting().create();</span>
<span class="nc" id="L507"> 	String ret = gsonb.toJson(ord);</span>
 	
<span class="nc" id="L509"> 	JsonObject returnObj = gson.fromJson(ret, JsonObject.class);</span>
<span class="nc" id="L510"> 	returnObj.remove(&quot;sid&quot;);</span>
<span class="nc" id="L511"> 	returnObj.remove(&quot;numberOfTickets&quot;);</span>
<span class="nc" id="L512"> 	returnObj.remove(&quot;pat&quot;);</span>
<span class="nc" id="L513"> 	JsonArray returnTic = returnObj.getAsJsonArray(&quot;tickets&quot;);</span>
 	
<span class="nc" id="L515"> 	List&lt;String&gt; tIDs = new ArrayList&lt;String&gt;();</span>
 	
<span class="nc bnc" id="L517" title="All 2 branches missed."> 	for(int i=0; i&lt;returnTic.size(); i++) {</span>
<span class="nc" id="L518"> 		returnTic.get(i).getAsJsonObject().remove(&quot;price&quot;);</span>
<span class="nc" id="L519"> 		returnTic.get(i).getAsJsonObject().remove(&quot;status&quot;);</span>
<span class="nc" id="L520"> 		returnTic.get(i).getAsJsonObject().remove(&quot;wid&quot;);</span>
<span class="nc" id="L521"> 		returnTic.get(i).getAsJsonObject().remove(&quot;showInfo&quot;);</span>
<span class="nc" id="L522"> 		returnTic.get(i).getAsJsonObject().remove(&quot;patronInfo&quot;);</span>
<span class="nc" id="L523"> 		returnTic.get(i).getAsJsonObject().remove(&quot;sid&quot;);</span>
<span class="nc" id="L524"> 		returnTic.get(i).getAsJsonObject().remove(&quot;section_name&quot;);</span>
<span class="nc" id="L525"> 		returnTic.get(i).getAsJsonObject().remove(&quot;row&quot;);</span>
<span class="nc" id="L526"> 		returnTic.get(i).getAsJsonObject().remove(&quot;cid&quot;);</span>
 		
 		//String tID = returnTic.get(i).getAsJsonObject().get(&quot;tid&quot;).toString(); 
 		//tIDs.add(tID);
 	}
 	
 	//returnObj.remove(&quot;tickets&quot;);
 	     
<span class="nc" id="L534"> 	ret = gsonb.toJson(returnObj);</span>
<span class="nc" id="L535"> 	return Response.ok(ret).build();</span>
     }
 	
 	
    //VIEW ALL ORDERS
    @Path(&quot;/orders&quot;)
    @GET
    @Produces(MediaType.APPLICATION_JSON)
    public Response getAllOrders() {
        // calls the &quot;Get All Shows&quot; use case
<span class="nc" id="L545">        Gson gson = new GsonBuilder().setPrettyPrinting().create();</span>
<span class="nc" id="L546">        List&lt;orders&gt; showsList = iord.getAllOrders();</span>
<span class="nc" id="L547">        String s = gson.toJson(showsList);</span>
        
<span class="nc" id="L549">        JsonArray objArr = gson.fromJson(s, JsonArray.class);</span>
<span class="nc bnc" id="L550" title="All 2 branches missed.">        for(int i=0; i&lt;objArr.size(); i++) {</span>
<span class="nc" id="L551">        		objArr.get(i).getAsJsonObject().remove(&quot;sid&quot;);</span>
<span class="nc" id="L552">        		objArr.get(i).getAsJsonObject().remove(&quot;tickets&quot;);</span>
        }
        
<span class="nc" id="L555">        s =gson.toJson(objArr);</span>
<span class="nc" id="L556">        return Response.status(Response.Status.OK).entity(s).build();</span>
    }
    
    
    //VIEW ORDERS BY DATE
    @Path(&quot;/ordersD&quot;)
    @GET
    @Produces(MediaType.APPLICATION_JSON)
    public Response getAutoSeats(@QueryParam(&quot;start_date&quot;) String startD, @QueryParam(&quot;end_date&quot;) String endD) {
            // calls the &quot;Get All Shows&quot; use case
<span class="nc" id="L566">            Gson gson = new GsonBuilder().setPrettyPrinting().create();</span>

            
<span class="nc" id="L569">            List&lt;orders&gt; ordersList = iord.getAllOrders();</span>
<span class="nc" id="L570">            List&lt;orders&gt; dateList = new ArrayList&lt;orders&gt;();</span>
            
<span class="nc bnc" id="L572" title="All 2 branches missed.">            for(int i=0; i&lt;ordersList.size(); i++) {</span>
<span class="nc" id="L573">            		orders ord = ordersList.get(i);</span>
<span class="nc" id="L574">            		Date dOrdered = ord.getDateOrdered();</span>
<span class="nc" id="L575">            		SimpleDateFormat formatter = new SimpleDateFormat(&quot;YYYYMMDD&quot;);</span>
<span class="nc" id="L576">            		Date dStart = null;</span>
<span class="nc" id="L577">            		Date dEnd = null;</span>
            		
            		
            		try {
<span class="nc" id="L581">						dStart = formatter.parse(startD);</span>
<span class="nc" id="L582">					} catch (ParseException e) {</span>
<span class="nc" id="L583">						e.printStackTrace();</span>
<span class="nc" id="L584">					}</span>
            		
            		try {
<span class="nc" id="L587">						dEnd = formatter.parse(endD);</span>
<span class="nc" id="L588">					} catch (ParseException e) {</span>

<span class="nc" id="L590">						e.printStackTrace();</span>
<span class="nc" id="L591">					}</span>
            		
<span class="nc" id="L593">            		System.out.println(&quot;START &quot; +dStart);</span>
<span class="nc" id="L594">            		System.out.println(&quot;END &quot; +dEnd);</span>
<span class="nc" id="L595">            		System.out.println(&quot;ORDERED &quot; +dOrdered);</span>
<span class="nc" id="L596">            		System.out.println(&quot;-----&quot;);	</span>
<span class="nc" id="L597">            		System.out.println(dOrdered.before(dEnd));</span>
<span class="nc" id="L598">            		System.out.println(dOrdered.after(dStart));</span>
<span class="nc" id="L599">            		System.out.println(&quot;-----NEW------&quot;);</span>
<span class="nc" id="L600">            		System.out.println(dOrdered.before(dStart));</span>
<span class="nc" id="L601">            		System.out.println(dOrdered.after(dEnd));</span>
<span class="nc" id="L602">            		System.out.println(&quot;-----&quot;);</span>
            		
            		
<span class="nc bnc" id="L605" title="All 4 branches missed.">            			if((dOrdered.before(dEnd))&amp;&amp;(dOrdered.after(dStart))) {</span>
<span class="nc" id="L606">            				System.out.println(&quot;adding&quot;);</span>
<span class="nc" id="L607">            				dateList.add(ord);</span>
            			}
            		
            }
            
<span class="nc" id="L612">            String s = gson.toJson(dateList);</span>
<span class="nc" id="L613">            return Response.status(Response.Status.OK).entity(s).build();</span>
        }
    
    //VIEW ORDER
    @Path(&quot;/orders/{id}&quot;)
    @GET
    @Produces(MediaType.APPLICATION_JSON)
    public Response getSpecificOrder(@PathParam(&quot;id&quot;) int oid) {
        // call the &quot;Get Show Detail&quot; use case
<span class="nc" id="L622">        orders ord = iord.getOrderDetail(oid);</span>
<span class="nc bnc" id="L623" title="All 2 branches missed.">        if (ord.isNil()) {</span>
            // return a 404
<span class="nc" id="L625">            return Response.status(Response.Status.NOT_FOUND).entity(&quot;:( Entity not found for ID: &quot; + oid).build();</span>
        } else {
<span class="nc" id="L627">            Gson gson = new GsonBuilder().setPrettyPrinting().create();</span>
<span class="nc" id="L628">            String st = gson.toJson(ord);</span>
            
            
<span class="nc" id="L631">            JsonObject obj = gson.fromJson(st, JsonObject.class);</span>
<span class="nc" id="L632">            obj.remove(&quot;sid&quot;);</span>
            		
<span class="nc" id="L634">            		JsonArray ticArr = obj.getAsJsonArray(&quot;tickets&quot;);</span>
<span class="nc bnc" id="L635" title="All 2 branches missed.">            		for(int j = 0; j&lt;ticArr.size(); j++) {</span>
            			
<span class="nc" id="L637">            			ticArr.get(j).getAsJsonObject().remove(&quot;price&quot;);</span>
<span class="nc" id="L638">            			ticArr.get(j).getAsJsonObject().remove(&quot;wid&quot;);</span>
<span class="nc" id="L639">            			ticArr.get(j).getAsJsonObject().remove(&quot;showInfo&quot;);</span>
<span class="nc" id="L640">            			ticArr.get(j).getAsJsonObject().remove(&quot;patronInfo&quot;);</span>
<span class="nc" id="L641">            			ticArr.get(j).getAsJsonObject().remove(&quot;sid&quot;);</span>
<span class="nc" id="L642">            			ticArr.get(j).getAsJsonObject().remove(&quot;section_name&quot;);</span>
<span class="nc" id="L643">            			ticArr.get(j).getAsJsonObject().remove(&quot;row&quot;);</span>
<span class="nc" id="L644">            			ticArr.get(j).getAsJsonObject().remove(&quot;cid&quot;);</span>
            		}
            
            
<span class="nc" id="L648">            st =gson.toJson(obj);</span>
<span class="nc" id="L649">            return Response.status(Response.Status.OK).entity(st).build();</span>
        }
    }
    
    
    
    
    ///////////////////////////////TICKETS///////////////////////////////
    
    	
    //VIEW TICKET
    @Path(&quot;/tickets/{id}&quot;)
    @GET
    @Produces(MediaType.APPLICATION_JSON)
    public Response getSpecificTicket(@PathParam(&quot;id&quot;) int tid) {
        // call the &quot;Get Show Detail&quot; use case
<span class="nc" id="L665">        ticket tic = itic.getTicketDetail(tid);</span>
<span class="nc bnc" id="L666" title="All 2 branches missed.">        if (tic.isNil()) {</span>
            // return a 404
<span class="nc" id="L668">            return Response.status(Response.Status.NOT_FOUND).entity(&quot;:( Entity not found for ID: &quot; + tid).build();</span>
        } else {
<span class="nc" id="L670">            Gson gson = new GsonBuilder().setPrettyPrinting().create();</span>
<span class="nc" id="L671">            String st = gson.toJson(tic);</span>
<span class="nc" id="L672">            return Response.ok(st).build();</span>
        }
    }
    
    //SCAN TICKET
    @Path(&quot;/tickets/{id}&quot;)
    @POST
    @Produces(MediaType.APPLICATION_JSON)
    public Response scanTicket(@PathParam(&quot;tid&quot;) int tid, String json) {
 		
<span class="nc" id="L682">        Gson gson = new Gson();</span>
        
<span class="nc" id="L684">        JsonObject obj = gson.fromJson(json, JsonObject.class);</span>
<span class="nc" id="L685">		JsonElement tidJSON = obj.get(&quot;tid&quot;);</span>
<span class="nc" id="L686">		JsonElement statusJSON = obj.get(&quot;status&quot;);</span>
		
<span class="nc" id="L688"> 		int tidInt = Integer.parseInt(tidJSON.toString().substring(1,tidJSON.toString().length()-1));		</span>
<span class="nc" id="L689">		String statusString = statusJSON.toString().substring(1,statusJSON.toString().length()-1);</span>
		
<span class="nc" id="L691">		List&lt;ticket&gt; tixList = itic.getAllTickets();</span>
		
<span class="nc bnc" id="L693" title="All 2 branches missed.">		for(int i=0; i&lt;tixList.size(); i++) {</span>
<span class="nc bnc" id="L694" title="All 2 branches missed.">			if(tixList.get(i).getTid().equals(Integer.toString(tidInt)))</span>
<span class="nc" id="L695">				tixList.get(i).setStatus(statusString);</span>
		}
		
		
		
<span class="nc" id="L700">		Gson gsonb = new GsonBuilder().setPrettyPrinting().create();</span>
<span class="nc" id="L701">	 	String ret = gsonb.toJson(obj);</span>
	 	     
<span class="nc" id="L703">	 	return Response.ok(ret).build();</span>
    }
    
    //DONATE TICKET
    @Path(&quot;/tickets/donations&quot;)
    @POST
    @Produces(MediaType.APPLICATION_JSON)
    public Response donateTicket(String json) {
<span class="nc" id="L711">    		ArrayList&lt;Integer&gt; listInt = new ArrayList&lt;Integer&gt;();</span>
 		
<span class="nc" id="L713">        Gson gson = new Gson();</span>
        
<span class="nc" id="L715">        JsonObject obj = gson.fromJson(json, JsonObject.class);</span>
<span class="nc" id="L716">        JsonArray ticArr = obj.getAsJsonArray(&quot;tickets&quot;);</span>
        
<span class="nc bnc" id="L718" title="All 2 branches missed.">        for(int i = 0; i&lt;ticArr.size(); i++) {</span>
<span class="nc" id="L719">        		JsonElement tidJSON = ticArr.get(i);</span>
<span class="nc" id="L720">        		int tidInt = Integer.parseInt(tidJSON.toString().substring(1,tidJSON.toString().length()-1));	</span>
<span class="nc" id="L721">        		listInt.add(tidInt);</span>
        }
        
<span class="nc" id="L724">		itic.donateTicket(listInt);</span>
		
<span class="nc" id="L726">		Gson gsonb = new GsonBuilder().setPrettyPrinting().create();</span>
<span class="nc" id="L727">	 	String ret = gsonb.toJson(obj);</span>
	 	     
<span class="nc" id="L729">	 	return Response.ok(ret).build();</span>
    }
    
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span>testCases (Nov 23, 2017 9:16:09 PM)</div></body></html>